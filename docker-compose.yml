version: "3.8"

services:
  devoups-agent:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: devoups-agent
    restart: unless-stopped
    environment:
      - AGENT_TOKEN=${AGENT_TOKEN}
      - AGENT_CLIENT_TOKEN=${AGENT_CLIENT_TOKEN:-}
      - AGENT_HOSTNAME=${AGENT_HOSTNAME:-test-server}
      - AGENT_LOG_LEVEL=${AGENT_LOG_LEVEL:-info}
      - AGENT_FRONTEND_HOST=${AGENT_FRONTEND_HOST:-0.0.0.0}
      - AGENT_FRONTEND_PORT=${AGENT_FRONTEND_PORT:-7080}
      - DOCKER_SOCKET_PATH=/var/run/docker.sock
    volumes:
      # Monter le socket Docker pour accéder au daemon Docker
      - /var/run/docker.sock:/var/run/docker.sock:ro
    network_mode: host
    # Nécessite l'accès au socket Docker du host
    # Note: En production, considérer l'utilisation de Docker-in-Docker ou d'un socket sécurisé
